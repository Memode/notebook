{"version":3,"sources":["components/modals/addsmodal.js"],"names":["__webpack_require__","_antd","_common","_reactRedux","_employeeModalReducer","_staffReducer","_react2","default","createElement","className","ADDSModal","connect","state","loginUser","userReducer","mEmployee","staffReducer","currentDept","deptReducer","toggleModalState","getMEL","getStaffList","props","_this","_classCallCheck","this","_getPrototypeOf","call","isAllocation","limit","page","employeeArray","lastPage","total","selectedUserArray","handleOk","bind","_assertThisInitialized","handleCancel","deptAddStaff","getMore","changgeSort","onChange","React","Component","checkedValues","setState","length","ndid","departmentId","params","map","u","newDeptId","enterpriseUserIds","message","config","top","error","_this2","http","put","then","res","status","success","deptId","e","getEmployee","np","object","list","concat","currentPage","_this3","cdId","dcdeId","filter","employee","departments","some","d","dd","userId","Modal","width","visible","title","centered","onCancel","footer","Button","key","onClick","type","Checkbox","Group","style","value","Avatar","src","getAvatar","cloudUserId","name","_ref"],"mappings":"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","file":"static/js/3.32437286.chunk.js","sourcesContent":["//添加员工（部门管理员）\r\nimport React from 'react'\r\nimport {Modal,Button,Checkbox,message,Avatar} from 'antd'\r\nimport {getAvatar} from 'libs/common'\r\nimport {connect} from 'react-redux'\r\nimport http from 'libs/http'\r\nimport {toggleModalState} from 'store/employeeModalReducer'\r\nimport {getMEL,getStaffList} from 'store/staffReducer'\r\nimport './modal.scss'\r\n@connect(\r\n    state=>{\r\n        return{\r\n            loginUser:state.userReducer,\r\n            mEmployee:state.staffReducer.mEmployee,\r\n            currentDept:state.deptReducer.currentDept\r\n        }\r\n    },\r\n    {toggleModalState,getMEL,getStaffList}\r\n)\r\nclass ADDSModal extends React.Component{\r\n    constructor(props){\r\n        super(props)\r\n        this.state={\r\n            //请求相关参数\r\n            isAllocation:'',//已分配1未分配-1,所有''\r\n            limit:30,\r\n            page:1,\r\n            //用户列表，逐个拼接，加载更多\r\n            employeeArray:[],\r\n            lastPage:false,\r\n            total:0,\r\n            //选中的人\r\n            selectedUserArray:[]\r\n        }\r\n        this.handleOk=this.handleOk.bind(this)\r\n        this.handleCancel=this.handleCancel.bind(this)\r\n        this.deptAddStaff=this.deptAddStaff.bind(this)\r\n        this.getMore=this.getMore.bind(this)\r\n        this.changgeSort=this.changgeSort.bind(this)\r\n        this.onChange=this.onChange.bind(this)\r\n\r\n    }\r\n    onChange(checkedValues){\r\n        this.setState({selectedUserArray:checkedValues})\r\n    }\r\n    handleOk(){\r\n        if(this.state.selectedUserArray.length>0){\r\n            let ndid=this.props.currentDept.departmentId\r\n            let params=this.state.selectedUserArray.map(u=>{\r\n                return {newDeptId:ndid,enterpriseUserIds:u}\r\n            })\r\n            this.deptAddStaff(params)\r\n        }else{\r\n            message.config({top:99})\r\n            message.error('请先选择员工！')\r\n        }\r\n    }\r\n    deptAddStaff(params){\r\n        http.put('enterprise/user/move',params).then(res=>{\r\n            if(res && res.status===200){\r\n                message.success('添加成功')\r\n                this.props.toggleModalState('DEFAULT',false)\r\n                this.props.getStaffList({deptId:this.props.currentDept.departmentId})\r\n            }\r\n        })\r\n    }\r\n    changgeSort(e){\r\n        //改变查询条件时清空状态\r\n        this.setState({\r\n            isAllocation:e,\r\n            limit:30,\r\n            page:1,\r\n            employeeArray:[],\r\n            lastPage:false,\r\n        })\r\n        this.getEmployee({isAllocation:e})\r\n    }\r\n    getEmployee(params){\r\n        this.props.getMEL(params)\r\n    }\r\n    getMore(){\r\n        if(!this.state.lastPage){\r\n            this.getEmployee({\r\n                page:this.state.page+1,\r\n                isAllocation:this.state.isAllocation\r\n            })\r\n        }\r\n    }\r\n    componentWillReceiveProps(np){\r\n        if(np.mEmployee &&  np.mEmployee.object && np.mEmployee.object.length>0){\r\n            const list=this.state.employeeArray.concat(np.mEmployee.object)\r\n            this.setState({\r\n                employeeArray:list,\r\n                page:np.mEmployee.currentPage,\r\n                total:np.mEmployee.total,\r\n                lastPage:list.length===np.mEmployee.total?true:false\r\n            })\r\n        }else if(np.mEmployee &&  np.mEmployee.total===0){\r\n            this.setState({\r\n                employeeArray:[],\r\n                page:1,\r\n                total:0,\r\n                lastPage:true\r\n            })\r\n        }\r\n    }\r\n    componentWillMount(){\r\n        this.getEmployee(null)\r\n    }\r\n    handleCancel(){\r\n       this.props.toggleModalState('DEFAULT',false)\r\n    }\r\n    render(){\r\n        //过滤当前部门的人\r\n        const cdId=this.props.currentDept.departmentId\r\n        let {employeeArray}=this.state\r\n        //current dept employee\r\n        let cde=employeeArray.filter((employee)=>{\r\n            let departments=employee.departments\r\n            //current dept employee\r\n            let cdemp=departments.some(d=>{return d.departmentId===cdId})\r\n            if(cdemp){\r\n                return employee\r\n            }\r\n        })\r\n        //current dept employee userId\r\n        let dcdeId=cde.map(dd=>{return dd.userId})\r\n        return (\r\n            <Modal\r\n                width={350}\r\n                visible={true}\r\n                title=\"添加员工\" centered\r\n                onCancel={this.handleCancel}\r\n                footer={[\r\n                    <Button key='1'  onClick={this.handleCancel}>取消</Button>,\r\n                    <Button  key='2' type=\"primary\"  onClick={this.handleOk}>确认</Button>,\r\n                ]}\r\n                >\r\n                <div className=\"add-staff-modal\">\r\n                    <div className=\"sort cp\">\r\n                        <div onClick={()=>this.changgeSort('')} className={this.state.isAllocation===''?'active':''}>所有成员</div>\r\n                        <div onClick={()=>this.changgeSort('-1')} className={this.state.isAllocation==='-1'?'active':''}>待分配</div>\r\n                    </div>\r\n                    <div className=\"radio-wrapper\">\r\n                        <Checkbox.Group style={{ width: '100%' }} onChange={this.onChange}>\r\n                            {this.state.employeeArray&&this.state.employeeArray.length>0?this.state.employeeArray.map(employee=>{\r\n                                return dcdeId.some((dd)=>{return dd===employee.userId})?null:<div className=\"radio-class\" key={employee.userId}>\r\n                                    <Checkbox  value={employee.userId}>\r\n                                        <Avatar src={getAvatar(employee.cloudUserId)}></Avatar>\r\n                                        <span className=\"ml6\">{employee.name}</span>\r\n                                    </Checkbox>\r\n                                </div>\r\n                            }):null}\r\n                        </Checkbox.Group>\r\n                        {this.state.total===0?<div className=\"tc\">暂无记录</div>:this.state.lastPage?null:<div className=\"cp theme-color tc\" onClick={this.getMore}>加载更多</div>}\r\n                    </div>\r\n                </div>\r\n            </Modal>\r\n        )\r\n    }\r\n}\r\n\r\nexport default ADDSModal"],"sourceRoot":""}