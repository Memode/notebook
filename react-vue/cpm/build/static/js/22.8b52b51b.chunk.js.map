{"version":3,"sources":["components/capamodals/uocmodal.js"],"names":["__webpack_require__","_antd","_reactRedux","_capaReducer","_staffReducer","_deptReducer","UOCModal","connect","state","loginUser","userReducer","sumaryCapacity","capaReducer","activePerson","staffReducer","toggleCapaModalState","getStaffList","getDeptList","searchAll","selectedStaff","props","_this","_classCallCheck","this","_getPrototypeOf","call","defaultValue","min","max","handleCancel","bind","_assertThisInitialized","handleOk","onChange","React","Component","params","id","cloudUserId","type","modifyType","spaceQuota","batchUpdate","console","log","_this$props","setState","Math","floor","spaceTotal","spacePicUsed","residuePicQuota","_this2","http","put","then","res","data","code","Modal","success","title","centered","content","userRole","msg","val","_react2","default","createElement","width","visible","autoFocus","concat","name","onCancel","footer","Button","key","onClick","InputNumber","style","size","color","fontSize"],"mappings":"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","file":"static/js/22.8b52b51b.chunk.js","sourcesContent":["//设置员工容量（update employee capacity）\r\nimport React from 'react'\r\nimport {Modal,Button,InputNumber} from 'antd'\r\nimport {connect} from 'react-redux'\r\nimport http from 'libs/http'\r\nimport {toggleCapaModalState,searchAll} from 'store/capaReducer'\r\nimport {getStaffList,selectedStaff} from 'store/staffReducer'\r\nimport {getDeptList} from 'store/deptReducer'\r\n@connect(\r\n    state=>{\r\n        return{\r\n            loginUser:state.userReducer,\r\n            sumaryCapacity:state.capaReducer.sumaryCapacity,\r\n            activePerson:state.staffReducer.activePerson,\r\n        }\r\n    },\r\n    {toggleCapaModalState,getStaffList,getDeptList,searchAll,selectedStaff}\r\n)\r\nclass UOCModal extends React.Component{\r\n    constructor(props){\r\n        super(props)\r\n        this.state={\r\n            defaultValue:1,\r\n            //加减容量的最大最小值\r\n            min:0,\r\n            max:0\r\n        }\r\n        this.handleCancel=this.handleCancel.bind(this)\r\n        this.handleOk=this.handleOk.bind(this)\r\n        this.onChange=this.onChange.bind(this)\r\n    }\r\n    handleOk(){\r\n        let {activePerson} = this.props\r\n        let params\r\n        if(this.state.defaultValue>0){\r\n            //增加容量,modifyType修改类型（人员p，部门d，文库l）\r\n            params=[{id:activePerson.cloudUserId,type:1,modifyType:'p',spaceQuota:this.state.defaultValue}]\r\n        }else{\r\n            //减少容量\r\n            params=[{id:activePerson.cloudUserId,type:0,modifyType:'p',spaceQuota:-this.state.defaultValue}]\r\n        }\r\n        \r\n        this.batchUpdate(params)\r\n    }\r\n    componentDidMount(){\r\n        console.log(this.props.activePerson)\r\n        //selectedStaffList只有userId\r\n        let {sumaryCapacity,activePerson} = this.props\r\n        \r\n        this.setState({\r\n            min:-Math.floor(activePerson.spaceTotal-activePerson.spacePicUsed),\r\n            max:Math.floor(sumaryCapacity.residuePicQuota)\r\n        })\r\n    }\r\n    //Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memory leak in your application\r\n    componentWillUnmount(){\r\n        this.setState({\r\n            max:0,\r\n            min:0\r\n        })\r\n    }\r\n    batchUpdate(params){\r\n        http.put('enterprise/spaceQu/batchUpdate',params).then(res=>{\r\n            if(res.data.code===200){\r\n                Modal.success({\r\n                    title: '系统提示',\r\n                    centered:true,\r\n                    content: '操作成功!',\r\n                })\r\n                //请求成功，刷新部门容量、容量使用概述、员工容量列表\r\n                this.props.getDeptList({type:this.props.loginUser.userRole})\r\n                this.props.getStaffList()\r\n                this.props.searchAll()\r\n                this.props.toggleCapaModalState('SET_ONE_CAPA',false)\r\n                //操作之后刷新数据（操作selectedRowKeys）\r\n                this.props.selectedStaff([])\r\n                this.setState({defaultValue:1})\r\n            }else{\r\n                Modal.success({\r\n                    title: '系统提示',\r\n                    centered:true,\r\n                    content: res.data.msg,\r\n                })\r\n            }\r\n        })\r\n    }\r\n    //修改的容量\r\n    onChange(val){\r\n        this.setState({\r\n            defaultValue:val\r\n        })\r\n    }\r\n    handleCancel(){\r\n        this.props.toggleCapaModalState('SET_ONE_CAPA',false)\r\n    }\r\n    //容量可以加减\r\n    render(){\r\n        return(\r\n            <Modal\r\n                width={350}\r\n                visible={true}\r\n                autoFocus={true}\r\n                title={`设置“${this.props.activePerson.name}”容量(单位：G)`} centered\r\n                onCancel={this.handleCancel}\r\n                footer={[\r\n                    <Button key='1'  onClick={this.handleCancel}>取消</Button>,\r\n                    <Button  key='2' type=\"primary\"  onClick={this.handleOk}>保存</Button>,\r\n                ]}\r\n                >\r\n                <div>\r\n                    <InputNumber style={{width:'200px'}} autoFocus size='large'  \r\n                    min={this.state.min} max={this.state.max} defaultValue={this.state.defaultValue} onChange={this.onChange} />\r\n                </div>\r\n                <div style={{color:'#666666',fontSize:'14px',}}>修改的容量是在已有容量的基础上增加或减少且不能低于已用的容量</div>\r\n            </Modal>\r\n        )\r\n    }\r\n}\r\n\r\nexport default UOCModal"],"sourceRoot":""}