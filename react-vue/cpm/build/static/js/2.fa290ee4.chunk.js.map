{"version":3,"sources":["components/modals/sddmodal.js"],"names":["__webpack_require__","_antd","_common","_reactRedux","_employeeModalReducer","_staffReducer","_react2","default","createElement","className","SDDModal","connect","state","loginUser","userReducer","mEmployee","staffReducer","currentDept","deptReducer","toggleModalState","getStaffList","getMEL","props","_this","_classCallCheck","this","_getPrototypeOf","call","pointUserId","isAllocation","page","searchName","employeeArray","lastPage","total","sortway","sortWays","handleOk","bind","_assertThisInitialized","handleCancel","setManager","onChange","getMore","changgeSort","React","Component","getEmployee","deptId","departmentId","np","tp","object","length","console","log","list","concat","setState","currentPage","params","message","error","w","_this2","pointType","http","put","then","res","status","Modal","success","title","centered","content","e","target","value","cdId","ddId","filter","employee","departments","urole","userRoleInfos","Object","assign","some","dr","roleName","map","dd","userId","allAreDirector","width","visible","onCancel","footer","Button","key","onClick","type","Radio","Group","style","Avatar","src","getAvatar","cloudUserId","name","_ref","_ref2"],"mappings":"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","file":"static/js/2.fa290ee4.chunk.js","sourcesContent":["//指定部门主管（必须是部门内部的人）\r\nimport React from 'react'\r\nimport {Modal,Button,message,Radio,Avatar} from 'antd'\r\nimport {getAvatar} from 'libs/common'\r\nimport {connect} from 'react-redux'\r\nimport http from 'libs/http'\r\nimport {toggleModalState} from 'store/employeeModalReducer'\r\nimport {getStaffList,getMEL} from 'store/staffReducer'\r\nimport './modal.scss'\r\n@connect(\r\n    state=>{\r\n        return{\r\n            loginUser:state.userReducer,\r\n            mEmployee:state.staffReducer.mEmployee,\r\n            currentDept:state.deptReducer.currentDept\r\n        }\r\n    },\r\n    {toggleModalState,getStaffList,getMEL}\r\n)\r\nclass SDDModal extends React.Component{\r\n    constructor(props){\r\n        super(props)\r\n        this.state={\r\n            pointUserId:'',\r\n            //请求相关参数\r\n            isAllocation:'',//已分配未分配\r\n            page:1,\r\n            searchName:'',\r\n            \r\n            //用户列表，逐个拼接，加载更多\r\n            employeeArray:[],\r\n            lastPage:false,\r\n            total:0,\r\n            sortway:'当前部门',\r\n            sortWays:['当前部门','所有员工','未分配']\r\n        }\r\n        this.handleOk=this.handleOk.bind(this)\r\n        this.handleCancel=this.handleCancel.bind(this)\r\n        this.setManager=this.setManager.bind(this)\r\n        this.onChange=this.onChange.bind(this)\r\n        this.getMore=this.getMore.bind(this)\r\n        this.changgeSort=this.changgeSort.bind(this)\r\n    }\r\n    componentDidMount(){\r\n        this.getEmployee({deptId:this.props.currentDept.departmentId})\r\n    }\r\n    componentWillReceiveProps(np){\r\n        const tp=this.props\r\n\r\n        //第一次加载数据\r\n        if(!tp.mEmployee &&  np.mEmployee && np.mEmployee.object && np.mEmployee.object.length>0){\r\n            console.log('第一次加载数据')\r\n            const list=this.state.employeeArray.concat(np.mEmployee.object)\r\n            this.setState({\r\n                employeeArray:list,\r\n                page:np.mEmployee.currentPage,\r\n                total:np.mEmployee.total,\r\n                lastPage:list.length===np.mEmployee.total?true:false\r\n            })\r\n        }else if(tp.mEmployee &&  np.mEmployee && np.mEmployee.object && np.mEmployee.object.length>0){\r\n            //点击加载更多\r\n            console.log('点击加载更多')\r\n            const list=this.state.employeeArray.concat(np.mEmployee.object)\r\n            this.setState({\r\n                employeeArray:list,\r\n                page:np.mEmployee.currentPage,\r\n                total:np.mEmployee.total,\r\n                lastPage:list.length===np.mEmployee.total?true:false\r\n            })\r\n        }else if(np.mEmployee &&  np.mEmployee.total===0){\r\n            console.log('加载完所有数据')\r\n            this.setState({\r\n                employeeArray:[],\r\n                page:1,\r\n                total:0,\r\n                lastPage:true\r\n            })\r\n        }\r\n    }\r\n    //获取员工列表\r\n    getEmployee(params){\r\n        this.props.getMEL(params)\r\n    }\r\n    getMore(){\r\n        if(!this.state.lastPage && this.state.sortway!=='当前部门'){\r\n            this.getEmployee({\r\n                page:this.state.page+1,\r\n                isAllocation:this.state.isAllocation\r\n            })\r\n        }else if(!this.state.lastPage && this.state.sortway==='当前部门'){\r\n            this.getEmployee({\r\n                page:this.state.page+1,\r\n                isAllocation:this.state.isAllocation,\r\n                deptId:this.props.currentDept.departmentId\r\n            })\r\n        }\r\n    }\r\n    handleOk(){\r\n        //判空\r\n        if(this.state.pointUserId!==''){\r\n            this.setManager()\r\n        }else{\r\n            message.error('请先进入要操作的部门')\r\n        }\r\n    }\r\n    changgeSort(w){\r\n        //所有员工或者未分配的员工\r\n        if( w==='所有员工'|| w==='未分配'){\r\n            this.setState({\r\n                isAllocation:w==='所有员工'?'':w==='未分配'?'-1':'1',\r\n            })\r\n            this.getEmployee({\r\n                isAllocation:w==='所有员工'?'':'-1'\r\n            })\r\n        }else if(w==='当前部门'){\r\n            //当前部门的员工\r\n            this.setState({isAllocation:''})\r\n            this.getEmployee({\r\n                deptId:this.props.currentDept.departmentId\r\n            })\r\n        }\r\n        //改变查询条件时清空状态\r\n        this.setState({\r\n            sortway:w,\r\n            page:1,\r\n            employeeArray:[],\r\n            lastPage:false,\r\n        })\r\n    }\r\n    setManager(){\r\n        let params={\r\n            pointUserId:this.state.pointUserId,\r\n            //（0.：企业管理员1.：部门主管2.：部门管理员）\r\n            pointType:'1',\r\n            deptId:this.props.currentDept.departmentId\r\n        }\r\n        http.put('enterprise/admin/setManager',params).then(res=>{\r\n            if(res && res.status===200){\r\n                Modal.success({\r\n                    title: '系统提示',\r\n                    centered:true,\r\n                    content: '操作成功！',\r\n                })\r\n                this.props.toggleModalState('DEFAULT',false)\r\n                //指定完成之后刷新当前页面\r\n                this.props.getStaffList({deptId:this.props.currentDept.departmentId})\r\n            }\r\n        })\r\n    }\r\n    handleCancel(){\r\n       this.props.toggleModalState('DEFAULT',false)\r\n    }\r\n    onChange(e) {\r\n        this.setState({pointUserId:e.target.value})\r\n    }\r\n    render(){\r\n        //排除已经是当前部门主管的人\r\n        const cdId=this.props.currentDept.departmentId\r\n        let {employeeArray}=this.state\r\n        let deptDirectors=employeeArray.filter((employee)=>{\r\n            let departments=employee.departments\r\n            let urole=employee.userRoleInfos\r\n            const departAndrole=Object.assign(departments,urole)\r\n            //current dept director\r\n            let cdm=departAndrole.some(dr=>{return dr.departmentId===cdId && dr.roleName && dr.roleName==='DEPT_DIRECTOR'})\r\n            if(cdm){\r\n                return employee\r\n            }\r\n        })\r\n        //dept director id\r\n        let ddId=deptDirectors.map(dd=>{return dd.userId})\r\n        //如果这个部门都是管理员（测试的时候又可能出现这个情况）\r\n        let allAreDirector=employeeArray.length===ddId.length\r\n        console.log(allAreDirector)\r\n        return (\r\n            <Modal\r\n                width={300}\r\n                visible={true}\r\n                title=\"指定部门主管\" centered\r\n                onCancel={this.handleCancel}\r\n                footer={[\r\n                    <Button key='1'  onClick={this.handleCancel}>取消</Button>,\r\n                    <Button  key='2' type=\"primary\"  onClick={this.handleOk}>确认</Button>,\r\n                ]}\r\n                >\r\n                <div className=\"radio-wrapper\">\r\n                    <Radio.Group style={{ width: '100%' }} onChange={this.onChange}>\r\n                        {this.state.employeeArray&&this.state.employeeArray.length>0?this.state.employeeArray.map(employee=>{\r\n                            return ddId.some((dd)=>{return dd===employee.userId})?null:<div className=\"radio-class\" key={employee.userId}>\r\n                                <Radio  value={employee.userId}>\r\n                                    <Avatar src={getAvatar(employee.cloudUserId)}></Avatar>\r\n                                    <span className=\"ml6\">{employee.name}</span>\r\n                                </Radio>\r\n                            </div>\r\n                        }):null}\r\n                        {employeeArray.length>0&&allAreDirector?<div className=\"radio-class tc\">当前部门员工都是部门主管</div>:null}\r\n                    </Radio.Group>\r\n                    {this.state.total===0?<div className=\"tc\">暂无记录</div>:this.state.lastPage?null:<div className=\"cp theme-color tc\" onClick={this.getMore}>加载更多</div>}\r\n                </div>\r\n            </Modal>\r\n        )\r\n    }\r\n}\r\n\r\nexport default SDDModal"],"sourceRoot":""}