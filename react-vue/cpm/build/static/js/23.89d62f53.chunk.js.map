{"version":3,"sources":["components/capamodals/secmodal.js"],"names":["__webpack_require__","_antd","_reactRedux","_capaReducer","_staffReducer","SECModal","connect","state","sumaryCapacity","capaReducer","enterpriseTotal","staffReducer","toggleCapaModalState","searchAll","getStaffList","props","_this","_classCallCheck","this","_getPrototypeOf","call","defaultValue","min","max","handleCancel","bind","_assertThisInitialized","handleOk","onChange","React","Component","params","id","type","modifyType","spaceQuota","batchUpdate","_this2","http","put","then","res","data","code","Modal","success","title","centered","content","setState","msg","_this$props","Math","floor","residuePicQuota","val","_react2","default","createElement","width","visible","autoFocus","onCancel","footer","Button","key","onClick","InputNumber","style","size","color","fontSize"],"mappings":"kJACA,QAAAA,EAAA,IACAC,EAAAD,EAAA,KACAE,EAAAF,EAAA,QACAA,EAAA,KACAG,EAAAH,EAAA,KACAI,EAAAJ,EAAA,kyBAUMK,GATL,EAAAH,EAAAI,SACG,SAAAC,GACI,MAAM,CACFC,eAAeD,EAAME,YAAYD,eACjCE,gBAAgBH,EAAMI,aAAaD,kBAG3C,CAACE,4CAAqBC,sBAAUC,4CAGhC,SAAAT,EAAYU,GAAM,IAAAC,MAAA,mGAAAC,CAAAC,KAAAb,KACda,MAAAF,MAAAG,EAAAd,GAAAe,KAAAF,KAAMH,oDACDR,MAAM,CACPc,aAAa,EACbC,IAAI,EACJC,IAAI,GAERP,EAAKQ,aAAaR,EAAKQ,aAAaC,KAAlBC,IAAAV,KAClBA,EAAKW,SAASX,EAAKW,SAASF,KAAdC,IAAAV,KACdA,EAAKY,SAASZ,EAAKY,SAASH,KAAdC,IAAAV,KATAA,yPADCa,UAAMC,oDAarB,IAAIC,EAGAA,EAFDb,KAAKX,MAAMc,aAAa,EAEhB,CAACW,IAAI,EAAEC,KAAK,EAAEC,WAAW,IAAIC,WAAWjB,KAAKX,MAAMc,cAGlD,CAACW,IAAI,EAAEC,KAAK,EAAEC,WAAW,IAAIC,YAAYjB,KAAKX,MAAMc,cAEhEH,KAAKkB,YAAYL,uCAETA,GAAO,IAAAM,EAAAnB,KACfoB,UAAKC,IAAI,8CAA8CR,GAAQS,KAAK,SAAAC,GAC7C,MAAhBA,EAAIC,KAAKC,MACRC,QAAMC,QAAQ,CACVC,MAAO,2BACPC,UAAS,EACTC,QAAS,8BAGbX,EAAKtB,MAAMF,YACXwB,EAAKtB,MAAMD,eACXuB,EAAKtB,MAAMH,qBAAqB,kBAAiB,GAEjDyB,EAAKY,SAAS,CAAC5B,aAAa,KAE5BuB,QAAMC,QAAQ,CACVC,MAAO,2BACPC,UAAS,EACTC,QAASP,EAAIC,KAAKQ,+CAO9BhC,KAAKH,MAAMH,qBAAqB,kBAAiB,+CAElC,IAAAuC,EACwBjC,KAAKH,MAAvCP,EADU2C,EACV3C,eAAeE,EADLyC,EACKzC,gBACpBQ,KAAK+B,SAAS,CAEV1B,IAAI6B,KAAKC,MAAM7C,EAAe8C,gBAAgB5C,GAE9CY,IAAI,mDAKRJ,KAAK+B,SAAS,CACV1B,IAAI,EACJD,IAAI,qCAIHiC,GACLrC,KAAK+B,SAAS,CACV5B,aAAakC,qCAIjB,OACIC,EAAAC,QAAAC,cAACzD,EAAA2C,MAAD,CACIe,MAAO,IACPC,SAAS,EACTC,WAAW,EACXf,MAAM,wEAAiBC,UAAQ,EAC/Be,SAAU5C,KAAKM,aACfuC,OAAQ,CACJP,EAAAC,QAAAC,cAACzD,EAAA+D,OAAD,CAAQC,IAAI,IAAKC,QAAShD,KAAKM,cAA/B,gBACAgC,EAAAC,QAAAC,cAACzD,EAAA+D,OAAD,CAASC,IAAI,IAAIhC,KAAK,UAAWiC,QAAShD,KAAKS,UAA/C,kBAEJ6B,EAAAC,QAAAC,cAAA,WACIF,EAAAC,QAAAC,cAACzD,EAAAkE,YAAD,CAAaC,MAAO,CAACT,MAAM,SAAUU,KAAK,QAAS/C,KAAMJ,KAAKX,MAAMe,IAAKC,IAAKL,KAAKX,MAAMgB,IAAKF,aAAcH,KAAKX,MAAMc,aAAeO,SAAUV,KAAKU,YAEzJ4B,EAAAC,QAAAC,cAAA,OAAKU,MAAO,CAACE,MAAM,UAAUC,SAAS,SAAtC,4OAMDlE","file":"static/js/23.89d62f53.chunk.js","sourcesContent":["//设置员工人均容量（set everage capacity）\r\nimport React from 'react'\r\nimport {Modal,Button,InputNumber} from 'antd'\r\nimport {connect} from 'react-redux'\r\nimport http from 'libs/http'\r\nimport {toggleCapaModalState,searchAll} from 'store/capaReducer'\r\nimport {getStaffList} from 'store/staffReducer'\r\n@connect(\r\n    state=>{\r\n        return{\r\n            sumaryCapacity:state.capaReducer.sumaryCapacity,\r\n            enterpriseTotal:state.staffReducer.enterpriseTotal,\r\n        }\r\n    },\r\n    {toggleCapaModalState,searchAll,getStaffList}\r\n)\r\nclass SECModal extends React.Component{\r\n    constructor(props){\r\n        super(props)\r\n        this.state={\r\n            defaultValue:1,\r\n            min:0,\r\n            max:0\r\n        }\r\n        this.handleCancel=this.handleCancel.bind(this)\r\n        this.handleOk=this.handleOk.bind(this)\r\n        this.onChange=this.onChange.bind(this)\r\n    }\r\n    handleOk(){\r\n        let params\r\n        if(this.state.defaultValue>0){\r\n            //增加容量,modifyType修改类型（人员p，部门d，文库l）\r\n            params={id:-1,type:1,modifyType:'p',spaceQuota:this.state.defaultValue}\r\n        }else{\r\n            //减少容量\r\n            params= {id:-1,type:0,modifyType:'p',spaceQuota:-this.state.defaultValue}\r\n        }\r\n        this.batchUpdate(params)\r\n    }\r\n    batchUpdate(params){\r\n        http.put('enterprise/spaceQu/batchUpdate/employeesAll',params).then(res=>{\r\n            if(res.data.code===200){\r\n                Modal.success({\r\n                    title: '系统提示',\r\n                    centered:true,\r\n                    content: '操作成功!',\r\n                })\r\n                //请求成功，刷新部门容量、容量使用概述、员工容量列表\r\n                this.props.searchAll()\r\n                this.props.getStaffList()\r\n                this.props.toggleCapaModalState('SET_EVERY_CAPA',false)\r\n                //操作之后刷新数据（操作selectedRowKeys）\r\n                this.setState({defaultValue:1})\r\n            }else{\r\n                Modal.success({\r\n                    title: '系统提示',\r\n                    centered:true,\r\n                    content: res.data.msg,\r\n                })\r\n            }\r\n            \r\n        })\r\n    }\r\n    handleCancel(){\r\n        this.props.toggleCapaModalState('SET_EVERY_CAPA',false)\r\n    }\r\n    componentDidMount(){\r\n        let {sumaryCapacity,enterpriseTotal} = this.props\r\n        this.setState({\r\n            //最大不能超过企业剩余容量除以员工人数\r\n            max:Math.floor(sumaryCapacity.residuePicQuota/enterpriseTotal) ,\r\n            //最小没有办法计算（获取所有员工，找到剩余容量最小的那个）\r\n            min:0,\r\n        })\r\n    }\r\n    //Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memory leak in your application\r\n    componentWillUnmount(){\r\n        this.setState({\r\n            max:0,\r\n            min:0\r\n        })\r\n    }\r\n    //修改的容量\r\n    onChange(val){\r\n        this.setState({\r\n            defaultValue:val\r\n        })\r\n    }\r\n    render(){\r\n        return(\r\n            <Modal\r\n                width={350}\r\n                visible={true}\r\n                autoFocus={true}\r\n                title=\"设置员工人均容量(单位：G)\" centered\r\n                onCancel={this.handleCancel}\r\n                footer={[\r\n                    <Button key='1'  onClick={this.handleCancel}>取消</Button>,\r\n                    <Button  key='2' type=\"primary\"  onClick={this.handleOk}>保存</Button>,\r\n                ]}>\r\n                <div>\r\n                    <InputNumber style={{width:'200px'}} size='large'  min={-this.state.min} max={this.state.max} defaultValue={this.state.defaultValue}  onChange={this.onChange} />\r\n                </div>\r\n                <div style={{color:'#666666',fontSize:'14px',}}>修改的容量是在已有容量的基础上增加或减少且不能低于已用的容量</div>\r\n            </Modal>\r\n        )\r\n    }\r\n}\r\n\r\nexport default SECModal"],"sourceRoot":""}