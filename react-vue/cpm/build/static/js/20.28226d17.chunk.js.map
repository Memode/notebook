{"version":3,"sources":["components/capamodals/udcmodal.js"],"names":["__webpack_require__","_antd","_reactRedux","_capaReducer","_deptReducer","UDCModal","connect","state","loginUser","userReducer","sumaryCapacity","capaReducer","selectedDept","toggleCapaModalState","searchAll","getDeptList","props","_this","_classCallCheck","this","_getPrototypeOf","call","defaultValue","min","max","handleCancel","bind","_assertThisInitialized","handleOk","onChange","React","Component","params","id","clouldUserId","type","modifyType","spaceQuota","batchUpdate","_this2","http","put","then","res","data","code","Modal","success","title","centered","content","userRole","setState","msg","_this$props","Math","floor","residuePicQuota","departmentSpaceTotal","departmentPicSpaceUsed","val","_react2","default","createElement","width","visible","autoFocus","concat","name","onCancel","footer","Button","key","onClick","InputNumber","style","size","color","fontSize"],"mappings":"kJACA,QAAAA,EAAA,IACAC,EAAAD,EAAA,KACAE,EAAAF,EAAA,QACAA,EAAA,KACAG,EAAAH,EAAA,KACAI,EAAAJ,EAAA,kyBAWMK,GAVL,EAAAH,EAAAI,SACG,SAAAC,GACI,MAAM,CACFC,UAAUD,EAAME,YAChBC,eAAeH,EAAMI,YAAYD,eACjCE,aAAaL,EAAMI,YAAYC,eAGvC,CAACC,4CAAqBC,sBAAUC,0CAGhC,SAAAV,EAAYW,GAAM,IAAAC,MAAA,mGAAAC,CAAAC,KAAAd,KACdc,MAAAF,MAAAG,EAAAf,GAAAgB,KAAAF,KAAMH,oDACDT,MAAM,CACPe,aAAa,EACbC,IAAI,EACJC,IAAI,GAERP,EAAKQ,aAAaR,EAAKQ,aAAaC,KAAlBC,IAAAV,KAClBA,EAAKW,SAASX,EAAKW,SAASF,KAAdC,IAAAV,KACdA,EAAKY,SAASZ,EAAKY,SAASH,KAAdC,IAAAV,KATAA,yPADCa,UAAMC,oDAYf,IAEFC,EADCpB,EAAgBO,KAAKH,MAArBJ,aAIDoB,EAFDb,KAAKZ,MAAMe,aAAa,EAEhB,CAAC,CAACW,GAAGrB,EAAasB,aAAaC,KAAK,EAAEC,WAAW,IAAIC,WAAWlB,KAAKZ,MAAMe,eAG1E,CAAC,CAACW,GAAGrB,EAAasB,aAAaC,KAAK,EAAEC,WAAW,IAAIC,YAAYlB,KAAKZ,MAAMe,eAExFH,KAAKmB,YAAYN,uCAETA,GAAO,IAAAO,EAAApB,KACfqB,UAAKC,IAAI,iCAAiCT,GAAQU,KAAK,SAAAC,GAChC,MAAhBA,EAAIC,KAAKC,MACRC,QAAMC,QAAQ,CACVC,MAAO,2BACPC,UAAS,EACTC,QAAS,8BAGbX,EAAKvB,MAAMD,YAAY,CAACoB,KAAKI,EAAKvB,MAAMR,UAAU2C,WAClDZ,EAAKvB,MAAMF,YACXyB,EAAKvB,MAAMH,qBAAqB,oBAAmB,GACnD0B,EAAKa,SAAS,CAAC9B,aAAa,KAE5BwB,QAAMC,QAAQ,CACVC,MAAO,2BACPC,UAAS,EACTC,QAASP,EAAIC,KAAKS,oDAKf,IAAAC,EACqBnC,KAAKH,MAApCN,EADU4C,EACV5C,eAAeE,EADL0C,EACK1C,aACpBO,KAAKiC,SAAS,CAEV5B,IAAI+B,KAAKC,MAAM9C,EAAe+C,iBAE9BlC,IAAIgC,KAAKC,MAAM5C,EAAa8C,qBAAqB9C,EAAa+C,yEAKlExC,KAAKiC,SAAS,CACV5B,IAAI,EACJD,IAAI,qCAIHqC,GACLzC,KAAKiC,SAAS,CACV9B,aAAasC,2CAIjBzC,KAAKH,MAAMH,qBAAqB,oBAAmB,oCAGnD,OACIgD,EAAAC,QAAAC,cAAC9D,EAAA6C,MAAD,CACIkB,MAAO,IACPC,SAAS,EACTC,WAAW,EACXlB,MAAK,qBAAAmB,OAAQhD,KAAKH,MAAMJ,aAAawD,KAAhC,2CACLnB,UAAQ,EACRoB,SAAUlD,KAAKM,aACf6C,OAAQ,CACJT,EAAAC,QAAAC,cAAC9D,EAAAsE,OAAD,CAAQC,IAAI,IAAKC,QAAStD,KAAKM,cAA/B,gBACAoC,EAAAC,QAAAC,cAAC9D,EAAAsE,OAAD,CAASC,IAAI,IAAIrC,KAAK,UAAWsC,QAAStD,KAAKS,UAA/C,kBAGJiC,EAAAC,QAAAC,cAAA,WACIF,EAAAC,QAAAC,cAAC9D,EAAAyE,YAAD,CAAaC,MAAO,CAACX,MAAM,SAAUE,WAAS,EAACU,KAAK,QACpDrD,KAAMJ,KAAKZ,MAAMgB,IAAKC,IAAKL,KAAKZ,MAAMiB,IAAKF,aAAcH,KAAKZ,MAAMe,aAAeO,SAAUV,KAAKU,YAEtGgC,EAAAC,QAAAC,cAAA,OAAKY,MAAO,CAACE,MAAM,UAAUC,SAAS,SAAtC,4OAMDzE","file":"static/js/20.28226d17.chunk.js","sourcesContent":["//修改部门容量（update dept capacity）\r\nimport React from 'react'\r\nimport {Modal,Button,InputNumber} from 'antd'\r\nimport {connect} from 'react-redux'\r\nimport http from 'libs/http'\r\nimport {toggleCapaModalState,searchAll} from 'store/capaReducer'\r\nimport {getDeptList} from 'store/deptReducer'\r\n@connect(\r\n    state=>{\r\n        return{\r\n            loginUser:state.userReducer,\r\n            sumaryCapacity:state.capaReducer.sumaryCapacity,\r\n            selectedDept:state.capaReducer.selectedDept\r\n        }\r\n    },\r\n    {toggleCapaModalState,searchAll,getDeptList}\r\n)\r\nclass UDCModal extends React.Component{\r\n    constructor(props){\r\n        super(props)\r\n        this.state={\r\n            defaultValue:1,\r\n            min:0,\r\n            max:0\r\n        }\r\n        this.handleCancel=this.handleCancel.bind(this)\r\n        this.handleOk=this.handleOk.bind(this)\r\n        this.onChange=this.onChange.bind(this)\r\n    }\r\n    handleOk(){\r\n        let {selectedDept} = this.props\r\n        let params\r\n        if(this.state.defaultValue>0){\r\n            //增加容量,modifyType修改类型（人员p，部门d，文库l）\r\n            params=[{id:selectedDept.clouldUserId,type:1,modifyType:'d',spaceQuota:this.state.defaultValue}]\r\n        }else{\r\n            //减少容量\r\n            params= [{id:selectedDept.clouldUserId,type:0,modifyType:'d',spaceQuota:-this.state.defaultValue}]\r\n        }\r\n        this.batchUpdate(params)\r\n    }\r\n    batchUpdate(params){\r\n        http.put('enterprise/spaceQu/batchUpdate',params).then(res=>{\r\n            if(res.data.code===200){\r\n                Modal.success({\r\n                    title: '系统提示',\r\n                    centered:true,\r\n                    content: '操作成功!',\r\n                })\r\n                //请求成功，刷新部门容量、容量使用概述、员工容量列表\r\n                this.props.getDeptList({type:this.props.loginUser.userRole})\r\n                this.props.searchAll()\r\n                this.props.toggleCapaModalState('UPDATE_DEPT_CAPA',false)\r\n                this.setState({defaultValue:1})\r\n            }else{\r\n                Modal.success({\r\n                    title: '系统提示',\r\n                    centered:true,\r\n                    content: res.data.msg,\r\n                })\r\n            }\r\n        })\r\n    }\r\n    componentDidMount(){\r\n        let {sumaryCapacity,selectedDept} = this.props\r\n        this.setState({\r\n            //最大不能超过企业剩余容量\r\n            max:Math.floor(sumaryCapacity.residuePicQuota),\r\n            //最小不能小于部门剩余容量\r\n            min:Math.floor(selectedDept.departmentSpaceTotal-selectedDept.departmentPicSpaceUsed)\r\n        })\r\n    }\r\n    //Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memory leak in your application\r\n    componentWillUnmount(){\r\n        this.setState({\r\n            max:0,\r\n            min:0\r\n        })\r\n    }\r\n    //修改的容量\r\n    onChange(val){\r\n        this.setState({\r\n            defaultValue:val\r\n        })\r\n    }\r\n    handleCancel(){\r\n        this.props.toggleCapaModalState('UPDATE_DEPT_CAPA',false)\r\n    }\r\n    render(){\r\n        return(\r\n            <Modal\r\n                width={350}\r\n                visible={true}\r\n                autoFocus={true}\r\n                title={`修改“${this.props.selectedDept.name}”容量(单位：G)`} \r\n                centered\r\n                onCancel={this.handleCancel}\r\n                footer={[\r\n                    <Button key='1'  onClick={this.handleCancel}>取消</Button>,\r\n                    <Button  key='2' type=\"primary\"  onClick={this.handleOk}>保存</Button>,\r\n                ]}\r\n                >\r\n                <div>\r\n                    <InputNumber style={{width:'200px'}} autoFocus size='large'  \r\n                    min={-this.state.min} max={this.state.max} defaultValue={this.state.defaultValue}  onChange={this.onChange} />\r\n                </div>\r\n                <div style={{color:'#666666',fontSize:'14px',}}>修改的容量是在已有容量的基础上增加或减少且不能低于已用的容量</div>\r\n            </Modal>\r\n        )\r\n    }\r\n}\r\n\r\nexport default UDCModal"],"sourceRoot":""}